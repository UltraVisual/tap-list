<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= beer ? 'Edit' : 'Add' %> Beer - Admin</title>
  <link rel="stylesheet" href="/public/css/admin.css">
</head>
<body>
  <div class="admin-header">
    <h1><%= settings.taproom_name %> &mdash; <%= beer ? 'Edit' : 'Add' %> Beer</h1>
    <nav>
      <a href="/admin">&larr; Back to Admin</a>
      <a href="/">View Tap List</a>
    </nav>
  </div>

  <div class="container">
    <div class="form-card">
      <form method="POST"
            action="<%= beer ? `/admin/beers/${beer.id}` : '/admin/beers' %>"
            enctype="multipart/form-data">

        <div class="form-row">
          <div class="form-group">
            <label for="tap_number">Tap Number</label>
            <input type="number" id="tap_number" name="tap_number" min="1"
                   value="<%= beer ? beer.tap_number : '' %>" required>
          </div>
          <div class="form-group">
            <label for="abv">ABV (%)</label>
            <input type="number" id="abv" name="abv" step="0.1" min="0" max="100"
                   value="<%= beer ? beer.abv : '' %>" required>
          </div>
        </div>

        <div class="form-group">
          <label for="name">Beer Name</label>
          <input type="text" id="name" name="name"
                 value="<%= beer ? beer.name : '' %>" required>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="style">Style</label>
            <input type="text" id="style" name="style" placeholder="e.g. IPA, Stout, Lager"
                   value="<%= beer ? beer.style : '' %>">
          </div>
          <div class="form-group">
            <label for="brewery">Brewery</label>
            <input type="text" id="brewery" name="brewery"
                   value="<%= beer ? beer.brewery : '' %>">
          </div>
        </div>

        <div class="form-group">
          <label for="description">Description</label>
          <textarea id="description" name="description" placeholder="Tasting notes, hops, etc."><%= beer ? beer.description : '' %></textarea>
        </div>

        <div class="form-group">
          <label for="image">Label Artwork</label>
          <input type="file" id="image" name="image" accept="image/*">
          <% if (beer && beer.image_path) { %>
            <div class="image-preview">
              <img src="<%= beer.image_path %>" alt="Current image">
              <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">Upload a new image to replace</p>
            </div>
          <% } %>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="pints_total">Keg Size (pints)</label>
            <input type="number" id="pints_total" name="pints_total" min="1" step="1"
                   value="<%= beer ? beer.pints_total : 38 %>">
          </div>
          <div class="form-group">
            <label for="pints_remaining">Pints Left</label>
            <input type="number" id="pints_remaining" name="pints_remaining" min="0" step="0.5"
                   value="<%= beer ? beer.pints_remaining : 38 %>">
          </div>
        </div>

        <div class="form-group">
          <div class="form-check">
            <input type="checkbox" id="is_draft" name="is_draft"
                   <%= (beer && beer.is_draft) ? 'checked' : '' %>>
            <label for="is_draft">Save as draft (don't show on display yet)</label>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary"><%= beer ? 'Update Beer' : 'Add Beer' %></button>
          <a href="/admin" class="btn btn-outline">Cancel</a>
        </div>
      </form>
    </div>
  </div>
  <script>
    (function() {
      var kegSize = document.getElementById('pints_total');
      var pintsLeft = document.getElementById('pints_remaining');
      var manuallyEdited = false;

      pintsLeft.addEventListener('input', function() { manuallyEdited = true; });

      kegSize.addEventListener('input', function() {
        if (!manuallyEdited) {
          pintsLeft.value = kegSize.value;
        }
        pintsLeft.max = kegSize.value;
      });

      // Set initial max
      pintsLeft.max = kegSize.value;
    })();
  </script>
</body>
</html>
